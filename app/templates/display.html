<!DOCTYPE html>
<html>
<head>
    <title>Display Media</title>
    <style>
        body {
            margin: 0;
            background-color: black;
        }
        #display-img, #display-video {
            display: block;
            margin: auto;
            max-width: 100vw;
            max-height: 100vh;
            object-fit: contain;
        }
        #display-video {
            display: none;
        }
    </style>
</head>
<body>
    <img id="display-img" src="" alt="Selected Image">
    <video id="display-video" autoplay loop muted playsinline></video>

    <script>
        let currentMedia = null;
        let currentType = null;

        async function fetchMedia() {
            try {
                const response = await fetch("/current_image");
                const data = await response.json();

                if (data.filename && data.filename !== currentMedia) {
                    currentMedia = data.filename;
                    currentType = data.type;

                    const img = document.getElementById("display-img");
                    const video = document.getElementById("display-video");

                    if (currentType === "video") {
                        img.style.display = "none";
                        video.style.display = "block";
                        video.src = currentMedia + "?t=" + Date.now(); // cache-buster
                        video.load();
                        video.play().catch(err => console.warn("Autoplay blocked:", err));
                    } else if (currentType === "image") {
                        video.pause();
                        video.style.display = "none";
                        img.style.display = "block";
                        img.src = currentMedia + "?t=" + Date.now();
                    }
                }
            } catch (err) {
                console.error("Error fetching media:", err);
            }
        }

        setInterval(fetchMedia, 500);
        fetchMedia(); // initial load
    </script>
</body>
</html>
